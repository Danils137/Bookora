# –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Supabase

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Bookora —Å –ª–æ–∫–∞–ª—å–Ω–æ–π mock-–±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –Ω–∞ Supabase.

## üìã –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —ç—Ç–∞–ø—ã

1. **–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** - –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è mock-–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
2. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** - –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `@supabase/supabase-js`
3. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase** - –°–æ–∑–¥–∞–Ω `.env.local` —Å –∫–ª—é—á–∞–º–∏ Supabase
4. **–°–æ–∑–¥–∞–Ω–∏–µ SQL —Å—Ö–µ–º—ã** - –°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏:
   - `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
   - `books` - –∫–Ω–∏–≥–∏
   - `orders` - –∑–∞–∫–∞–∑—ã
   - `order_items` - —ç–ª–µ–º–µ–Ω—Ç—ã –∑–∞–∫–∞–∑–æ–≤
   - `reviews` - –æ—Ç–∑—ã–≤—ã
5. **–°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤** - –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω—ã —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü–µ–π
6. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ tRPC —Ä–æ—É—Ç–æ–≤** - –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ä–æ—É—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Supabase

## üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü—ã

#### users
- `id` (UUID, Primary Key)
- `email` (TEXT, UNIQUE)
- `password` (TEXT)
- `name` (TEXT)
- `role` (TEXT: buyer, seller, admin)
- `status` (TEXT: active, pending, suspended)
- `company_name` (TEXT, nullable)
- `company_verified` (BOOLEAN)
- `created_at` (TIMESTAMP)
- `updated_at` (TIMESTAMP)

#### books
- `id` (UUID, Primary Key)
- `seller_id` (UUID, Foreign Key ‚Üí users.id)
- `title` (TEXT)
- `author` (TEXT)
- `isbn` (TEXT, UNIQUE)
- `description` (TEXT)
- `genre` (TEXT)
- `publisher` (TEXT)
- `price` (DECIMAL)
- `stock` (INTEGER)
- `image_url` (TEXT)
- `publication_year` (INTEGER)
- `language` (TEXT)
- `pages` (INTEGER)
- `created_at` (TIMESTAMP)
- `updated_at` (TIMESTAMP)

#### orders
- `id` (UUID, Primary Key)
- `buyer_id` (UUID, Foreign Key ‚Üí users.id)
- `total_amount` (DECIMAL)
- `status` (TEXT: pending, processing, shipped, delivered, cancelled)
- `shipping_address` (JSONB)
- `payment_id` (TEXT, nullable)
- `created_at` (TIMESTAMP)
- `updated_at` (TIMESTAMP)

#### order_items
- `id` (UUID, Primary Key)
- `order_id` (UUID, Foreign Key ‚Üí orders.id)
- `book_id` (UUID, Foreign Key ‚Üí books.id)
- `seller_id` (UUID, Foreign Key ‚Üí users.id)
- `quantity` (INTEGER)
- `price` (DECIMAL)

#### reviews
- `id` (UUID, Primary Key)
- `book_id` (UUID, Foreign Key ‚Üí books.id)
- `buyer_id` (UUID, Foreign Key ‚Üí users.id)
- `seller_id` (UUID, Foreign Key ‚Üí users.id)
- `rating` (INTEGER, 1-5)
- `comment` (TEXT)
- `created_at` (TIMESTAMP)

## üîí Row Level Security (RLS)

–ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü:

- **users**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
- **books**: –ö–Ω–∏–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ–º, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–≥—É—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–æ–¥–∞–≤—Ü—ã
- **orders**: –ü–æ–∫—É–ø–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Å–≤–æ–∏ –∑–∞–∫–∞–∑—ã, –ø—Ä–æ–¥–∞–≤—Ü—ã - –∑–∞–∫–∞–∑—ã –Ω–∞ —Å–≤–æ–∏ –∫–Ω–∏–≥–∏
- **reviews**: –û—Ç–∑—ã–≤—ã –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ–º, —É–ø—Ä–∞–≤–ª—è—Ç—å –º–æ–≥—É—Ç —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä—ã

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase

1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ SQL —Å–∫—Ä–∏–ø—Ç `supabase-schema.sql` –≤ SQL Editor –≤–∞—à–µ–≥–æ Supabase –ø—Ä–æ–µ–∫—Ç–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env.local` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

### 2. –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–æ—á–∏—Å—Ç–∏—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ)
npx ts-node test-migration.ts
```

### 3. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
npm run server

# –ó–∞–ø—É—Å–∫ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
npm run start-web
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ supabase.ts              # Supabase –∫–ª–∏–µ–Ω—Ç
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ userService.ts       # –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bookService.ts       # –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–Ω–∏–≥–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ orderService.ts      # –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∑–∞–∫–∞–∑–∞–º–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reviewService.ts     # –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—Ç–∑—ã–≤–∞–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ migrateData.ts           # –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ mock-db.ts               # –ò—Å—Ö–æ–¥–Ω–∞—è mock-–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ supabase-schema.sql          # SQL —Å—Ö–µ–º–∞ –¥–ª—è Supabase
‚îú‚îÄ‚îÄ test-migration.ts            # –¢–µ—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ types/
    ‚îî‚îÄ‚îÄ database.ts              # –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Supabase
```

## üîß –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

### UserService
- `getAll()` - –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `getById(id)` - –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID
- `getByEmail(email)` - –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email
- `create(userData)` - —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `update(id, userData)` - –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `delete(id)` - —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `getSellers()` - –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–¥–∞–≤—Ü–æ–≤
- `getBuyers()` - –ø–æ–ª—É—á–∏—Ç—å –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π

### BookService
- `getAll()` - –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–Ω–∏–≥–∏
- `getById(id)` - –ø–æ–ª—É—á–∏—Ç—å –∫–Ω–∏–≥—É –ø–æ ID
- `getBySeller(sellerId)` - –ø–æ–ª—É—á–∏—Ç—å –∫–Ω–∏–≥–∏ –ø—Ä–æ–¥–∞–≤—Ü–∞
- `getByGenre(genre)` - –ø–æ–ª—É—á–∏—Ç—å –∫–Ω–∏–≥–∏ –ø–æ –∂–∞–Ω—Ä—É
- `search(query)` - –ø–æ–∏—Å–∫ –∫–Ω–∏–≥
- `create(bookData)` - —Å–æ–∑–¥–∞—Ç—å –∫–Ω–∏–≥—É
- `update(id, bookData)` - –æ–±–Ω–æ–≤–∏—Ç—å –∫–Ω–∏–≥—É
- `delete(id)` - —É–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É
- `updateStock(id, stock)` - –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
- `getPopularGenres()` - –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –∂–∞–Ω—Ä—ã
- `getSellerStats(sellerId)` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–≤—Ü–∞

### OrderService
- `getAll()` - –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–∫–∞–∑—ã
- `getById(id)` - –ø–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑ –ø–æ ID
- `getByBuyer(buyerId)` - –ø–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
- `getBySeller(sellerId)` - –ø–æ–ª—É—á–∏—Ç—å –∑–∞–∫–∞–∑—ã –ø—Ä–æ–¥–∞–≤—Ü–∞
- `create(orderData)` - —Å–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑
- `updateStatus(id, status)` - –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
- `update(id, orderData)` - –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–∫–∞–∑
- `delete(id)` - —É–¥–∞–ª–∏—Ç—å –∑–∞–∫–∞–∑
- `getStats()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤
- `getByStatus(status)` - –∑–∞–∫–∞–∑—ã –ø–æ —Å—Ç–∞—Ç—É—Å—É

### ReviewService
- `getAll()` - –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ –æ—Ç–∑—ã–≤—ã
- `getById(id)` - –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–∑—ã–≤ –ø–æ ID
- `getByBook(bookId)` - –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–∑—ã–≤—ã –∫ –∫–Ω–∏–≥–µ
- `getByBuyer(buyerId)` - –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–∑—ã–≤—ã –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
- `getBySeller(sellerId)` - –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–∑—ã–≤—ã –ø—Ä–æ–¥–∞–≤—Ü–∞
- `create(reviewData)` - —Å–æ–∑–¥–∞—Ç—å –æ—Ç–∑—ã–≤
- `update(id, reviewData)` - –æ–±–Ω–æ–≤–∏—Ç—å –æ—Ç–∑—ã–≤
- `delete(id)` - —É–¥–∞–ª–∏—Ç—å –æ—Ç–∑—ã–≤
- `getBookStats(bookId)` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–∑—ã–≤–æ–≤ –∫–Ω–∏–≥–∏
- `getSellerStats(sellerId)` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–∑—ã–≤–æ–≤ –ø—Ä–æ–¥–∞–≤—Ü–∞
- `hasUserReviewedBook(bookId, buyerId)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∑—ã–≤–∞

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–î–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ mock-–±–∞–∑—ã:

```typescript
import { migrateData } from './lib/migrateData'

await migrateData()
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. **–ë—ç–∫–∞–ø—ã**: –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏
4. **–ò–Ω–¥–µ–∫—Å—ã**: –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É—é—Ç –∑–∞–ø—Ä–æ—Å—ã
5. **–¢–∏–ø—ã**: –û–±–Ω–æ–≤–ª–µ–Ω—ã —Ç–∏–ø—ã –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å Supabase

## üö® –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–î—É–±–ª–∏–∫–∞—Ç—ã**: –ü—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –æ—à–∏–±–∫–∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
2. **–°–≤—è–∑–∏**: –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π
3. **RLS**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–ª–∏—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL —Å—Ö–µ–º—ã –≤ Supabase
3. –õ–æ–≥–∏ –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
4. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ RLS –≤ Supabase Dashboard
